name: Deploy to Render

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Deploy to Render
        env:
          RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
          RENDER_SERVICE_ID: ${{ secrets.RENDER_SERVICE_ID }}
        run: |
          if [ -z "$RENDER_API_KEY" ] || [ -z "$RENDER_SERVICE_ID" ]; then
            echo "âš ï¸  Render credentials not configured. Skipping deployment."
            echo "To enable auto-deploy:"
            echo "1. Get your Render API key from https://dashboard.render.com/u/settings"
            echo "2. Add RENDER_API_KEY to GitHub Secrets"
            echo "3. Add RENDER_SERVICE_ID to GitHub Secrets"
            exit 0
          fi
          
          echo "ðŸš€ Deploying to Render..."
          
          RESPONSE=$(curl -X POST https://api.render.com/v1/services/$RENDER_SERVICE_ID/deploys \
            -H "Authorization: Bearer $RENDER_API_KEY" \
            -H "Content-Type: application/json" \
            -d '{"clearCache": false}')
          
          echo "Response: $RESPONSE"
          
          if echo "$RESPONSE" | grep -q '"id"'; then
            echo "âœ… Deployment triggered successfully!"
          else
            echo "âŒ Deployment failed"
            exit 1
          fi

      - name: Deployment Summary
        run: |
          echo "### ðŸš€ Deployment Status" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Commit**: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Branch**: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Triggered by**: ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Timestamp**: $(date -u +"%Y-%m-%d %H:%M:%S UTC")" >> $GITHUB_STEP_SUMMARY
